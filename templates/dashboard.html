{% extends "base.html" %}

{% block content %}
<!-- SeÃ§Ã£o para Upload do Arquivo HTML -->
<div id="upload-html">
  <h3>Carregar Arquivo HTML</h3>
  <form id="upload-form" enctype="multipart/form-data">
    <input type="file" id="html-file-input" name="html_file" accept=".html">
    <button type="button" onclick="uploadHTML()">Carregar HTML</button>
    <button id="process-btn" onclick="runPipeline()">ðŸš€ Executar Pipeline</button>

  </form>
</div>

<!-- SeÃ§Ã£o de RelatÃ³rio (TransaÃ§Ãµes) -->
<div id="aba-transacoes" class="aba visible">
  <h2>RelatÃ³rio de TransaÃ§Ãµes</h2>
  <table>
    <thead>
      <tr>
        <th>Data</th>
        <th>DescriÃ§Ã£o</th>
        <th>Valor</th>
        <th>Tipo TransaÃ§Ã£o</th>
        <th>Documento</th>
        <th>Contato</th>
        <th>Tipo</th>
        <th>Categoria</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      {% for item in data %}
        {% include "partials/row.html" %}
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- SeÃ§Ã£o de Gerenciador de Regras -->
<div id="aba-regras" class="aba">
  <h2>Gerenciador de Regras</h2>
  
  <!-- BotÃµes de AÃ§Ã£o para as Regras -->
  <div id="rules-actions" style="margin: 10px 0;">
    <button onclick="saveRules()">ðŸ’¾ Save Rules</button>
    <button onclick="loadRules()">ðŸ“¥ Load Rules</button>
    <button onclick="cleanRules()">ðŸ§¹ Clean Rules</button>
    <button onclick="exportRules()">ðŸ“„ Export Rules</button>
    <button onclick="document.getElementById('import-rules-input').click()">ðŸ“‚ Import Rules</button>
    <input type="file" id="import-rules-input" style="display: none;">
  </div>

  <!-- FormulÃ¡rio para Adicionar Nova Regra -->
  <form id="form-regra">
    <input name="descricao_contain" placeholder="DescriÃ§Ã£o contÃ©m (vÃ­rgula separada)">
    <input name="descricao_regex" placeholder="Regex de descriÃ§Ã£o">
    <input name="contato_igual" placeholder="Parte do nome do contato (opcional)">
    
    {% set tipos = [] %}
    {% for key, sublist in (config_json.tipos_por_transacao or {}).items() %}
      {% for t in sublist %}
        {% if t not in tipos %}
          {% set _ = tipos.append(t) %}
        {% endif %}
      {% endfor %}
    {% endfor %}
    <select name="tipo">
      <option value="">Selecione o tipo</option>
      {% for t in tipos %}
        <option value="{{ t }}">{{ t }}</option>
      {% endfor %}
    </select>
    
    <select name="categoria">
      <option value="">Selecione a categoria</option>
      {% for c in (config_json.categorias_por_tipo or {}).keys() %}
        <option value="{{ c }}">{{ c }}</option>
      {% endfor %}
    </select>
    
    <button type="button" onclick="adicionarRegra()">Salvar regra</button>
  </form>
  
  <!-- Tabela para Exibir as Regras Atuais -->
  <table id="tabela-regras">
    <thead>
      <tr>
        <th>DescriÃ§Ã£o ContÃ©m</th>
        <th>Regex</th>
        <th>Contato (parcial)</th>
        <th>Tipo</th>
        <th>Categoria</th>
        <th>AÃ§Ãµes</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
{% endblock %}
