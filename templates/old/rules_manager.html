{% extends "base.html" %}

{% block content %}
<div id="aba-regras" class="aba">
  <h2>Gerenciador de Regras</h2>
  <!-- BotÃµes de aÃ§Ãµes para as regras -->
  <div id="rules-actions" style="margin: 10px 0;">
    <button onclick="saveRules()">ðŸ’¾ Save Rules</button>
    <button onclick="loadRules()">ðŸ“¥ Load Rules</button>
    <button onclick="cleanRules()">ðŸ§¹ Clean Rules</button>
    <button onclick="exportRules()">ðŸ“„ Export Rules</button>
    <button onclick="document.getElementById('import-rules-input').click()">ðŸ“‚ Import Rules</button>
    <input type="file" id="import-rules-input" style="display: none;">
  </div>

  <!-- FormulÃ¡rio para adicionar nova regra -->
  <form id="form-regra">
    <input name="descricao_contain" placeholder="DescriÃ§Ã£o contÃ©m (vÃ­rgula separada)">
    <input name="descricao_regex" placeholder="Regex de descriÃ§Ã£o">
    <input name="contato_igual" placeholder="Parte do nome do contato (opcional)">
    
    {# ConstrÃ³i a lista Ãºnica de tipos a partir de config_json.tipos_por_transacao #}
    {% set tipos = [] %}
    {% for key, sublist in (config_json.tipos_por_transacao or {}).items() %}
      {% for t in sublist %}
        {% if t not in tipos %}
          {% set _ = tipos.append(t) %}
        {% endif %}
      {% endfor %}
    {% endfor %}
    <select name="tipo">
      <option value="">Selecione o tipo</option>
      {% for t in tipos %}
        <option value="{{ t }}">{{ t }}</option>
      {% endfor %}
    </select>
    
    <select name="categoria">
      <option value="">Selecione a categoria</option>
      {% for c in (config_json.categorias_por_tipo or {}).keys() %}
        <option value="{{ c }}">{{ c }}</option>
      {% endfor %}
    </select>
    
    <button type="button" onclick="adicionarRegra()">Salvar regra</button>
  </form>
  
  <!-- Tabela para exibir as regras atuais -->
  <table id="tabela-regras">
    <thead>
      <tr>
        <th>DescriÃ§Ã£o ContÃ©m</th>
        <th>Regex</th>
        <th>Contato (parcial)</th>
        <th>Tipo</th>
        <th>Categoria</th>
        <th>AÃ§Ãµes</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
{% endblock %}
