{% extends "base.html" %}

{% block content %}
<!-- SeÃ§Ã£o para Upload do Arquivo HTML -->
<div id="upload-html">
  <h3>Carregar Arquivo HTML</h3>
  <form id="upload-form" enctype="multipart/form-data">
    <input type="file" id="html-file-input" name="extrato_file" accept=".html,.ofx">
    <select id="banco-select" name="banco">
      <option value="sicoob">Sicoob (HTML)</option>
      <option value="bb">Banco do Brasil (OFX)</option>
    </select>
    <button type="button" onclick="uploadHTML()">Carregar HTML</button>

    <button id="process-btn" type="button" onclick="runPipeline()">ðŸš€ Executar Pipeline</button>
  </form>
</div>

<!-- SeÃ§Ã£o de RelatÃ³rio (TransaÃ§Ãµes) -->
<div id="aba-transacoes" class="aba visible">
  <h2>RelatÃ³rio de TransaÃ§Ãµes</h2>
  <div class="table-responsive">
    <table>
      <thead>
        <tr>
          <th class="thdata">Data</th>
          <th class="thdescription">DescriÃ§Ã£o</th>
          <th class="thvalor">Valor</th>
          <th class="thtipotransacao">Tipo TransaÃ§Ã£o</th>
          <th class="thdocumento">Documento</th>
          <th class="thcontato">Contato</th>
          <th class="thtipo">Tipo</th>
          <th class="thcategoria">Categoria</th>
          <th class="thmemo">Memo</th>
          <th class="thstatus">Status</th>
        </tr>
      </thead>
      <tbody>
        {% for item in data %}
          {% include "partials/row.html" %}
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- SeÃ§Ã£o de Gerenciador de Regras -->
<div id="aba-regras" class="aba">
  <h2>Gerenciador de Regras</h2>
  
  <!-- BotÃµes de AÃ§Ã£o para as Regras -->
  <div id="rules-actions" style="margin: 10px 0;">
    <button type="button" onclick="saveRules()">ðŸ’¾ Save Rules</button>
    <button type="button" onclick="loadRules()">ðŸ“¥ Load Rules</button>
    <button type="button" onclick="cleanRules()">ðŸ§¹ Clean Rules</button>
    <button type="button" onclick="exportRules()">ðŸ“„ Export Rules</button>
    <button type="button" onclick="document.getElementById('import-rules-input').click()">ðŸ“‚ Import Rules</button>
    <input type="file" id="import-rules-input" style="display: none;">
  </div>
  
  <!-- Tabela para Exibir as Regras (Sem Regex) -->
  <div class="table-responsive">
    <table id="tabela-regras">
      <thead>
        <tr>
          <th class="thdesccontain">DescriÃ§Ã£o ContÃ©m</th>
          <th class="thtransactionType">Tipo TransaÃ§Ã£o</th>
          <th class="thcontato">Contato (parcial)</th>
          <th class="thtipo">Tipo</th>
          <th class="thcategoria">Categoria</th>
          <th class="thmemo">Memo</th>
          <th class="thacoes">AÃ§Ãµes</th>
        </tr>
      </thead>
      <tbody>
        <!-- SerÃ¡ preenchido dinamicamente pelo JS -->
      </tbody>
    </table>
  </div>
  
  <!-- FormulÃ¡rio para Adicionar Nova Regra (Removendo Regex) -->
  <form id="form-regra">
    <input type="text" name="descricao_contain" placeholder="DescriÃ§Ã£o contÃ©m (vÃ­rgula separada)">
    
    <!-- Tipo de TransaÃ§Ã£o -->
    <select name="transaction_type">
      <option value="Indefinido">Indefinido</option>
      <option value="CrÃ©dito">CrÃ©dito</option>
      <option value="DÃ©bito">DÃ©bito</option>
    </select>
    
    <!-- Contato (parcial) -->
    <input type="text" name="contato_igual" placeholder="Parte do nome do contato (opcional)">
    
    <!-- Tipo (Ex.: Recebimentos, TransferÃªncia, etc.) -->
    <select name="tipo">
      <option value="">Selecione o Tipo</option>
      <option value="Recebimentos">Recebimentos</option>
      <option value="TransferÃªncia">TransferÃªncia</option>
      <!-- Outras opÃ§Ãµes -->
    </select>
    
    <!-- Categoria (Ex.: LocaÃ§Ã£o de equipamentos, Custos operacionais etc.) -->
    <select name="categoria">
      <option value="">Selecione a Categoria</option>
      <option value="LocaÃ§Ã£o de equipamentos">LocaÃ§Ã£o de equipamentos</option>
      <!-- Outras opÃ§Ãµes -->
    </select>
    
    <!-- Memo -->
    <input type="text" name="memo_rule" placeholder="Memo (preenchimento automÃ¡tico)">
    
    <button type="button" onclick="adicionarRegra()">Salvar Regra</button>
  </form>
</div>


  

<!-- Aba de Contatos -->
<div id="aba-contatos" class="aba">
  <h2>Gerenciador de Contatos</h2>
  
  <!-- BotÃµes de AÃ§Ã£o para Contatos -->
  <div id="contacts-actions" style="margin: 10px 0;">
    <button onclick="showAddContactForm()">âž•Adicionar Contato</button>
    <button type="button" onclick="exportContacts()">ðŸ“„ Exportar Contatos</button>
    <button type="button" onclick="document.getElementById('import-contacts-input').click()">ðŸ“‚ Importar Contatos</button>
    <input type="file" id="import-contacts-input" style="display: none;">
  </div>
  <!-- BotÃ£o para exibir o formulÃ¡rio -->


<!-- Container do formulÃ¡rio (pode ser um modal ou uma div fixa) -->
<div id="addContactFormContainer" style="display: none; border: 1px solid #ccc; padding: 1rem; background: #f9f9f9;">
  <h3>Adicionar Novo Contato</h3>
  <form id="addContactForm">
    <div>
      <label for="cpf_cnpj">CPF/CNPJ:</label>
      <input type="text" id="cpf_cnpj" name="cpf_cnpj" required>
    </div>
    <div>
      <label for="nome">Nome:</label>
      <input type="text" id="nome" name="nome" required>
    </div>
    <div>
      <label for="razao_social">RazÃ£o Social:</label>
      <input type="text" id="razao_social" name="razao_social">
    </div>
    <div>
      <label for="nome_fantasia">Nome Fantasia:</label>
      <input type="text" id="nome_fantasia" name="nome_fantasia">
    </div>
    <!-- Se nÃ£o usar 'socios' pode ser omitido ou definido como oculto -->
    <div>
      <button type="submit">Adicionar Contato</button>
      <button type="button" onclick="hideAddContactForm()">Cancelar</button>
    </div>
  </form>
</div>
  <!-- Tabela para Exibir os Contatos -->
  <div class="table-responsive">
    <table id="tabela-contatos">
      <thead>
        <tr>
          <th>CPF/CNPJ</th>
          <th>Nome</th>
          <th>RazÃ£o Social</th>
          <th>Nome Fantasia</th>
          <th>SÃ³cios</th>
          <th>AÃ§Ãµes</th>
        </tr>
      </thead>
      <tbody>
        <!-- SerÃ¡ preenchido dinamicamente -->
      </tbody>
    </table>
  </div>
</div>

{% endblock %}

{% block scripts_extra %}
  <!-- Inclua jQuery e DataTables se ainda nÃ£o estiverem incluÃ­dos -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

  <script>
    $(document).ready(function() {
      $('#minha-tabela').DataTable({
        "order": [[3, "asc"]] // Ordena pela quarta coluna (Tipo TransaÃ§Ã£o)
      });
    });
  </script>
{% endblock %}
